<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>imt00dizzy tv</title>
<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: black;
}
#player {
  width: 100%;
  height: 100%;
  border: 0;
}
#title {
  position: fixed;
  bottom: 16px;
  left: 16px;
  color: white;
  font-family: sans-serif;
  opacity: 0.7;
}
</style>
</head>
<body>
<iframe id="player" allowfullscreen></iframe>
<div id="title"></div>

<script>
let list = []
let index = 0

async function load() {
  const r = await fetch("https://imt00dizzy-rerun-backend.lovelylucyscorpse.workers.dev?parent=" + location.hostname)
  list = await r.json()
  play()
}

function play() {
  const clip = list[index]
  document.getElementById("player").src = clip.url + "&autoplay=true"
  document.getElementById("title").textContent = clip.title
  index = (index + 1) % list.length
}

window.addEventListener("message", e => {
  if (e.data?.event === "ended") play()
})

load()
</script>
</body>
</html>
